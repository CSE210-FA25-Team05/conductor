<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Conductor</title>
        <link rel="stylesheet" href="../styles/styles.css">
        <script src="../js/auth.js"></script>
    </head>
    <style>
    .copy-status {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #d4edda;
        color: #155724;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 0.9em;
        display: none; /* Hidden by default */
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }
    .copy-status.show {
        display: block;
        opacity: 1;
    }



    .copy-container {
        display: flex;
        align-items: center;
        gap: 10px;

        margin-bottom: 2em;

        margin-left: auto;
        margin-right: auto;
    }

    .copy-content {
        flex-grow: 1;
        padding-right: 5px;
    }

    .copy-content small {
        color: #555;
        font-size: 0.9em;
    }



    .copy-status {
        color: #28a745;
    }

    header,
    section {
        padding-bottom: 4em;
    }

    article {
        max-width: 20em;
    }

    main {
        display: grid;
        grid-template-cols: 1fr auto;
        padding-right: 0;
        margin-right: 0;
    }

    main > * {
        grid-column: 1;
    }

    #toc {
        padding: 0;
        margin: 0;
        max-width: 8em;
        grid-column: 2;
        grid-row: 1;

        position: sticky;
        top: 0;
        align-self: start;
    }

    #toc>nav>ul>li{
        padding: 0.5em 0;

    }


    </style>
    <body>
        <main>
            <header>
                <h1>Atomic Elements</h1>
                <p>This page serves as a UI reference tool. To add conent, use the following format: </p>
                <pre>
&lt;article class="copy-container"&gt;
    &lt;div class="copy-content"&gt;
        // HTML CONTENT HERE
    &lt;/div&gt;
    &lt;button class="copy-button icon-only"&gt;&lt;i&gt;content_copy&lt;/i&gt;&lt;/button&gt;
    &lt;span class="copy-status"&gt;&lt;/span&gt;
&lt;/article&gt;
                </pre>
            </header>
            <section>
                <header>
                    <h2 id="typography">Typography</h2>
                </header>


                <article class="copy-container">
                    <div class="copy-content">
                        <h1>Heading 1</h1>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <h2>Heading 2</h2>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <h3>Heading 3</h3>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <h4>Heading 4</h4>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <h5>Heading 5</h5>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <h6>Heading 6</h6>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <small>Here is some small text.</small>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <b>Here is some bold text.</b>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <em>Here is some italisized text.</em>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

            </section>

            <section>

                <header>
                <h2 id="colors">Colors</h2>
                </header>


                <article class="copy-container">
                    <div class="copy-content">
                        <article>
                        </article>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

            </section>

            <section>

                <header>
                <h2 id="cards">Cards</h2>
                <p>Cards are created with the <code>&lt;article&gt;</code> element.</p>
                <p><em>Note</em>: Cards will fill the width of their container.</p>
                </header>


                <article class="copy-container">
                    <div class="copy-content">
                        <article>
                            <p>Primary <br> (additional line to show line spacing)</p>
                        </article>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <article class="secondary">
                            <p>Secondary</p>
                        </article>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>
                <article class="copy-container">
                    <div class="copy-content">
                        <article class="error">
                            <p>Error</p>
                        </article>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <article class="success">
                            <p>Success</p>
                        </article>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <article class="neutral">
                            <p>Neutral</p>
                        </article>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

            </section>

            <section>

                <header>
                <h2 id="buttons">Buttons</h2>
                </header>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="primary">Primary Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="secondary">Secondary Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>


                <article class="copy-container">
                    <div class="copy-content">
                        <button class="error">Error Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="success">Success Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="neutral">Neutral Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="sm">Small Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="md">Medium Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="lg">Large Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="icon-only">
                            <i>cloud</i>
                        </button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button class="icon-round">
                            <i>cloud</i>
                        </button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button>
                            Add
                            <i>add</i>
                        </button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button>
                            <i>home</i>
                            Home
                        </button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

                <article class="copy-container">
                    <div class="copy-content">
                        <button disabled>Disabled Button</button>
                    </div>
                    <button class="copy-button icon-only"><i>content_copy</i></button>
                    <span class="copy-status"></span>
                </article>

            </section>

            <aside id="toc">
                <nav>
                    <ul>
                        <li><a href="#typography">Typography</a></li>
                        <li><a href="#colors">Colors</a></li>
                        <li><a href="#cards">Cards</a></li>
                        <li><a href="#buttons">Buttons</a></li>
                    </ul>
                </nav>
            </aside>
        </main>
        <aside>
            <conductor-nav></conductor-nav>
        </aside>
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            const copyButtons = document.querySelectorAll('.copy-container .copy-button');

            copyButtons.forEach(button => {
                button.addEventListener('click', async () => {
                    const copyContainer = button.closest('.copy-container');
                    const copyContentDiv = copyContainer.querySelector('.copy-content');
                    const copyStatusSpan = copyContainer.querySelector('.copy-status');

                    if (!copyContentDiv) {
                        console.error('No .copy-content found within this .copy-container.');
                        return;
                    }

                    const textToCopy = copyContentDiv.innerHTML.trim();
                    const lines = textToCopy.split('\n');

                    // Find the minimum common leading whitespace (excluding empty lines)
                    let minIndent = Infinity;
                    lines.forEach(line => {
                        if (line.trim().length > 0) { // Only consider non-empty lines
                            const leadingWhitespaceMatch = line.match(/^(\s*)/);
                            if (leadingWhitespaceMatch) {
                                const currentIndent = leadingWhitespaceMatch[1].length;
                                minIndent = Math.min(minIndent, currentIndent);
                            }
                        }
                    });

                    // If no non-empty lines or no common indent was found, just use the original content
                    if (minIndent === Infinity) {
                        minIndent = 0;
                    }
                    console.log("MIN INDENT: ", minIndent);

                    // Remove the common leading whitespace from each line
                    const cleanedLines = lines.map(line => {
                        // For empty lines or lines with less than minIndent, just return them as is
                        console.log("LINE LENG: ", line.length)
                        if (line.length < minIndent) {
                            return line;
                        }
                        return line.substring(minIndent);
                    });

                    // Join the lines back together
                    const cleanedHtmlContent = cleanedLines.join('\n');

                    // Copy to clipboard
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        try {
                            await navigator.clipboard.writeText(textToCopy);
                            showCopyStatus(copyStatusSpan, 'Copied HTML!');
                        } catch (err) {
                            console.error('Failed to copy HTML: ', err);
                            showCopyStatus(copyStatusSpan, 'Failed to copy!', true);
                        }
                    } else {
                        const tempTextArea = document.createElement('textarea');
                        tempTextArea.value = textToCopy;
                        document.body.appendChild(tempTextArea);
                        tempTextArea.select();
                        try {
                            const successful = document.execCommand('copy');
                            const msg = successful ? 'Copied HTML (fallback)! ' : 'Failed to copy HTML (fallback)!';
                            showCopyStatus(copyStatusSpan, msg, !successful);
                        } catch (err) {
                            console.error('Fallback: Failed to copy HTML: ', err);
                            showCopyStatus(copyStatusSpan, 'Failed (manual copy needed).', true);
                        }
                        document.body.removeChild(tempTextArea);
                        window.getSelection().removeAllRanges();
                    }
                });
            });

            function showCopyStatus(statusElement, message, isError = false) {
                statusElement.textContent = message;
                statusElement.classList.remove('error'); // Remove previous error state
                if (isError) {
                    statusElement.style.backgroundColor = '#f8d7da'; /* Light red */
                    statusElement.style.color = '#721c24'; /* Dark red */
                } else {
                    statusElement.style.backgroundColor = '#d4edda'; /* Light green */
                    statusElement.style.color = '#155724'; /* Dark green */
                }
                statusElement.classList.add('show');

                setTimeout(() => {
                    statusElement.classList.remove('show');
                }, 3000);
            }
        });
        </script>
        <script type="module" src="../components/conductor-nav/conductor-nav.js"></script>
    </body>
</html>
